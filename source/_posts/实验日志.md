---
title: 实验日志
date: 2018-08-16 15:04:50
tags: [record]
categories: 实验记录
---

## 假阳性减少

### 2018-08-16 在结节检测结果上进行五折交叉验证假阳性减少
尝试用假阳性减少模型在结节检测的结果上划分5折交叉验证，原始三分支网络和类google网络的第一折效果都非常不好，已停止。

新增代码目录：

     老服务器:~/Code/FPR_TEST_ON_DETECTION_RESULT/

数据：

     老服务器:/mnt/data1/lty/FPR_TEST_ON_DETECTION_RESULT/data/

结果目录：

     老服务器:/mnt/data1/lty/FPR_TEST_ON_DETECTION_RESULT/


### 2018-08-16 和结节检测使用同样的训练集进行假阳性减少
尝试用假阳性减少模型在结节检测的训练集上训练，然后再在结节检测结果上进行假阳性减少

network_v1使用常规的学习速率衰减0.95

network_v2使用断层的学习速率衰减：0.01 0.001 0.0001

新增代码目录：

     老服务器:~/Code/FPR_TEST_ON_DETECTION_TRAIN/

训练数据目录：

     老服务器:/mnt/data3/lty/MULTI_SIZE_FPR_ORI_CANDIDATE/data/

结节检测结果数据直接使用之前保存的pkl：

     老服务器:/mnt/data1/lty/FPR_TEST_ON_DETECTION_RESULT/data/

结果目录：

     老服务器:/mnt/data3/lty/FPR_TEST_ON_DETECTION_TRAIN/, 其中后缀为_detect的文件和文件夹

### 2018-08-16 尝试将假阳性减少模型修改为network_v6_google_net
尝试修改假阳性减少模型，在原来类googleNet的基础上，将原inception结构的BatchNormalization层和PRelu层拆分为三个，训练只完成了第一折的两代

修改代码目录：

     老服务器:~/Code/MULTI_SIZE_3DCNN_FPR/

训练数据目录：

     老服务器:/mnt/data3/lty/MULTI_SIZE_FPR_ORI_CANDIDATE/data/

结果目录：

     老服务器:/mnt/data3/lty/MULTI_SIZE_FPR_ORI_CANDIDATE/network_v6_google_net/

### 2018-08-17 尝试将预测值合并
在结节检测的假阳性减少结果上，对相邻点的预测值进行非极大值抑制，该算法暂时只做到保证合并全部同层相邻点，后面希望能合并所有相邻点，暂时最好的FROC结果从单纯结节检测+假阳性减少的69%提升到78%

修改代码：

     老服务器:~/Code/FPR_TEST_ON_DETECTION_TRAIN/fpr_predice.py, 新增merge_adjacent_candidate函数

训练数据目录：

     老服务器:/mnt/data3/lty/MULTI_SIZE_FPR_ORI_CANDIDATE/data/,

结节检测结果数据直接使用之前保存的pkl：

     老服务器:/mnt/data1/lty/FPR_TEST_ON_DETECTION_RESULT/data/

结果目录：

     老服务器:/mnt/data3/lty/FPR_TEST_ON_DETECTION_TRAIN/, 其中后缀为_clear的文件和文件夹

### 2018-08-17 尝试将预测值合并（层次聚类算法，agens）
在上次尝试的基础上，使用层次聚类算法agens对相邻点预测值进行非极大值抑制，暂时最好的FROC结果从单纯结节检测+假阳性减少的74%提升到80%

补充：发现增大聚类阈值时，FROC分数还可以提高，阈值为8.5时，FROC可以达到83.5%

补充：发现在之前的合并过程中利用了label信息，因此进行修改，此时阈值为7时，FROC可以达到82.8%

补充：发现之前的检测结果生成candidates文件时加入了未检测到的原始正样本，修改后，如果使用sens：96%，fps：49的结节检测结果，最高FROC只有82%，如果使用sens：94%，fps:28的检测结果，最高FROC只有81%

修改代码：

     老服务器:~/Code/FPR_TEST_ON_DETECTION_TRAIN/fpr_predice.py,新增merge_adjacent_candidate_agens函数， 新增~/Code/FPR_TEST_ON_DETECTION_TRAIN/AGENS.py文件

训练数据目录：

     老服务器:/mnt/data3/lty/MULTI_SIZE_FPR_ORI_CANDIDATE/data/

结节检测结果数据直接使用之前保存的pkl：

     老服务器:/mnt/data1/lty/FPR_TEST_ON_DETECTION_RESULT/data/

结果目录：

     老服务器:/mnt/data3/lty/FPR_TEST_ON_DETECTION_TRAIN/, 其中后缀为_clear_agens的文件和文件夹

### 2018-08-17 在结节检测结果上进行五折交叉验证假阳性减少（修改版）
在昨天的这个实验上，将正样本来源换成原始正样本，负样本约4000，正负样本比例大概为1:14，训练过程中，正负样本均增强500倍，且正样本过采样14次，训练样本共约2600000。采用原始的三分支网络，重新训练网络，模型训练一代后，训练集上99%正确率，验证集上只有88%正确率，FROC评分非常低

修改代码目录：

     老服务器:~/Code/FPR_TEST_ON_DETECTION_RESULT/

数据：

     老服务器:/mnt/data1/lty/FPR_TEST_ON_DETECTION_RESULT/data/

结果目录：

     老服务器:/mnt/data1/lty/FPR_TEST_ON_DETECTION_RESULT/network_v1_new_data/

### 2018-08-17 在结节检测结果上进行五折交叉验证假阳性减少（将基础网络替换为单分支3D DCNN）
在昨天的这个实验上，将正样本来源换成原始正样本，负样本约4000，正负样本比例大概为1:14，训练过程中，正负样本均增强500倍，且正样本过采样14次，训练样本共约2600000。采用单分支3D DCNN模型，重新训练，发现模型训练非常慢，20代的时候，验证集正确率92%，验证集loss仍然是下降趋势，因此继续训练

修改代码目录：

     老服务器:~/Code/FPR_TEST_ON_DETECTION_RESULT/

数据：

     老服务器:/mnt/data1/lty/FPR_TEST_ON_DETECTION_RESULT/data/

结果目录：

     老服务器:/mnt/data1/lty/FPR_TEST_ON_DETECTION_RESULT/network_v2_DCNN_new_data/

### 2018-08-21 使用多模型结果合并的方法来尝试提高FROC分数
尝试将原始的三分支网络的结果和修改后的googleNet网络的结果进行取平均合并，在前4折上进行试验，发现平均FROC提高了两个百分点，可以达到82%

修改代码目录：

     老服务器:~/Code/MULTI_SIZE_3DCNN_FPR/fpr_predice.py, 新增merge_mean_result函数，用于合并结果

训练数据目录：

     老服务器:/mnt/data3/lty/MULTI_SIZE_FPR_ORI_CANDIDATE/data/

结果目录：

     老服务器:/mnt/data3/lty/MULTI_SIZE_FPR_ORI_CANDIDATE/merge_mean/

### 2018-08-21 尝试新的多模型网络，分别使用ResNet、DenseNet、InceptionResNet这三个网络
本次试验数据候选结节来自candidate_V2.csv，数据准备过程中有等方性变换，
三个网络的输入大小都为（40， 40， 40， 1）
三个网络均为三分支多尺度（40， 40， 40）、（32， 32， 32）、（24， 24， 24）结构，只不过连接方式不同，尝试将三个网络训练好后进行结果合并（取平均），模型训练较慢。

补充：resnet训练三代耗时12个小时，第三代FROC：76

补充：resnet第一代和之前的DCNN结果求平均，FROC可以达到85.1，第三代resnet反而没那么好的效果，只有84.9

补充：使用没训练完的resnet、inception_resnet、densenet再加上DCNN结果求平均，FROC可以达到最高85.2

补充：修改了三个模型的结构，保存为networks_v2.py(使用多个小核卷积，代替单个大核卷积，使用中心池化代替最大池化和卷积下采样)，并将其在结节检测的验证集上进行训练，最高可以达到FROC：86.3

补充: networks_v2.py中的Ince_res和res和Densenet模型，在结节检测的测试集上训练，三者结果求平均，可以达到FROC:87.2

补充：networrks_v3.py中按照原论文简化ince_res、densenet、res三个模型的结构，使用PReLU代替原来的ReLU激活函数，并在一些块中添加1*1*1的降维卷积，增加深度同时减少计算量，训练尚未完成

新增代码目录：

     老服务器:~/Code/MULTI_SIZE_MULTI_MODEL_FPR/

数据：

     老服务器:/mnt/data4/lty/MULTI_SIZE_MULTI_MODEL_FPR/data/

结果目录：

     老服务器:/mnt/data4/lty/MULTI_SIZE_MULTI_MODEL_FPR/
     老服务器:/mnt/data4/lty/MULTI_SIZE_MULTI_MODEL_TRAIN_ON_DETECT_RESULT/

### 2018-08-22 开始尝试将结节检测部分打包成接口

新增代码目录：

     老服务器:~/Code/nodule_api/
     老服务器:~/Code/nodule_api_gpu/

### 2018-08-28 复现一个加权图像作为输入的假阳性减少的论文
复现此论文用于对比假阳性减少模型,AUC97时，FROC只有54.7

新增代码目录：

     老服务器:~/Code/WAIP_FPR/

数据：

     老服务器:/mnt/data4/lty/WAIP_FPR/data/

结果目录：

     老服务器:/mnt/data1/lty/WAIP_FPR/network_LeNet/

### 2018-08-29 尝试一个使用三视图图像作为输入的模型
尝试此模型用于对比假阳性减少模型,AUC98时，FROC只有69.3

新增代码目录：

     老服务器:~/Code/MULTI_VIEW_FPR/

数据：

     老服务器:/mnt/data4/lty/MULTI_VIEW_FPR/data/

结果目录：

     老服务器:/mnt/data1/lty/MULTI_VIEW_FPR/network/